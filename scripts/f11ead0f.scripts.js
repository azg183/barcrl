"use strict";angular.module("barcrlApp",["ngCookies","ngResource","ngSanitize","ngRoute","module.service","module.controller","module.filter","ui.bootstrap","ngSlider","chieffancypants.loadingBar","google-maps"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/Crawl/:barId",{templateUrl:"/views/crawl.html",controller:"CrawlCtrl"}).when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).otherwise({redirectTo:"/"}),b.html5Mode(!1)}]),angular.module("module.controller",["module.service"]).controller("MainCtrl",["$scope","$location",function(a,b){a.bars=[{id:"Allen.St..Grill",name:"Allen St. Grill",lat:"40.794302",lon:"-77.861613"},{id:"Bar.Bleu",name:"Bar Bleu",lat:"40.79773",lon:"-77.856613"},{id:"The.Brewery",name:"The Brewery",lat:"40.794952",lon:"-77.858437"},{id:"Cafe.210",name:"Cafe 210",lat:"40.793246",lon:"-77.862986"},{id:"Chilis",name:"Chilis",lat:"40.793864",lon:"-77.860543"},{id:"Chrome",name:"Chrome",lat:"40.791849",lon:"-77.862299"},{id:"Chumleys",name:"Chumley's",lat:"40.794188",lon:"-77.861763"},{id:"Darkhorse.Tavern",name:"Darkhorse Tavern",lat:"40.79466",lon:"-77.860218"},{id:"Gingerbread.Man",name:"Gingerbread Man",lat:"40.796706",lon:"-77.856849"},{id:"Indigo",name:"Indigo",lat:"40.794123",lon:"-77.861806"},{id:"Inferno",name:"Inferno",lat:"40.797535",lon:"-77.857321"},{id:"Kildares",name:"Kildares",lat:"40.800109",lon:"-77.85379"},{id:"Levels",name:"Levels",lat:"40.798233",lon:"-77.85627"},{id:"Lions.Den",name:"Lion's Den",lat:"40.797523",lon:"-77.856519"},{id:"Local.Whiskey",name:"Local Whiskey",lat:"40.793683",lon:"-77.860092"},{id:"Mad.Mex",name:"Mad Mex",lat:"40.793872",lon:"-77.85852"},{id:"The.Phyrst",name:"The Phyrst",lat:"40.793683",lon:"-77.860092"},{id:"Bill.Pickles.Tap.Room",name:"Bill Pickles Tap Room",lat:"40.794156",lon:"-77.861386"},{id:"The.Rathskeller",name:"The Rathskeller",lat:"40.795151",lon:"-77.860357"},{id:"Rotellis",name:"Rotellis",lat:"40.795699",lon:"-77.858772"},{id:"Rumors.Lounge",name:"Rumors Lounge",lat:"40.791536",lon:"-77.864552"},{id:"The.Saloon",name:"The Saloon",lat:"40.797315",lon:"-77.857395"},{id:"The.Shandygaff",name:"The Shandygaff",lat:"40.795301",lon:"-77.859534"},{id:"The.Tavern.Restaurant",name:"The Tavern Restaurant",lat:"40.795677",lon:"-77.859783"},{id:"Z.Bar...The.Deli",name:"Z Bar @ The Deli",lat:"40.797133",lon:"-77.857179"},{id:"Zenos",name:"Zenos",lat:"40.79432",lon:"-77.861621"}],a.goRandom=function(){var c=Math.floor(100*Math.random())%26;b.path("/Crawl/"+a.bars[c].id)}}]).controller("CrawlCtrl",["$scope","$modal","$log","crawlrService","cfpLoadingBar","$routeParams",function(a,b,c,d,e,f){function g(b){a.requestId=b}function h(b){a.routes=b,a.map.markers=i(b),a.map.polyline.path=a.map.markers}function i(a){var b=[],c=a[0],d=0;return c.bars.forEach(function(a){d+=1;var c=k(a);b.push(j(d,c))}),b}function j(a,b){return{position:a,id:b.id,name:b.name,latitude:b.lat,longitude:b.lon}}function k(b){for(var c in a.bars)if(a.bars[c].id===b)return a.bars[c]}function l(b){b="undefined"!=typeof b?b:"Creating Bar Crawl",a.status=b,a.queryRunning=!0,e.start()}function m(b){b="undefined"!=typeof b?b:"Creating Bar Crawl",a.status=b,a.queryRunning=!1,e.complete()}function n(){a.map.markers=[];var b=k(f.barId);a.map.markers.push(j(1,b))}a.bars=[{id:"Allen.St..Grill",name:"Allen St. Grill",lat:"40.794302",lon:"-77.861613"},{id:"Bar.Bleu",name:"Bar Bleu",lat:"40.79773",lon:"-77.856613"},{id:"The.Brewery",name:"The Brewery",lat:"40.794952",lon:"-77.858437"},{id:"Cafe.210",name:"Cafe 210",lat:"40.793246",lon:"-77.862986"},{id:"Chilis",name:"Chilis",lat:"40.793864",lon:"-77.860543"},{id:"Chrome",name:"Chrome",lat:"40.791849",lon:"-77.862299"},{id:"Chumleys",name:"Chumley's",lat:"40.794188",lon:"-77.861763"},{id:"Darkhorse.Tavern",name:"Darkhorse Tavern",lat:"40.79466",lon:"-77.860218"},{id:"Gingerbread.Man",name:"Gingerbread Man",lat:"40.796706",lon:"-77.856849"},{id:"Indigo",name:"Indigo",lat:"40.794123",lon:"-77.861806"},{id:"Inferno",name:"Inferno",lat:"40.797535",lon:"-77.857321"},{id:"Kildares",name:"Kildares",lat:"40.800109",lon:"-77.85379"},{id:"Levels",name:"Levels",lat:"40.798233",lon:"-77.85627"},{id:"Lions.Den",name:"Lion's Den",lat:"40.797523",lon:"-77.856519"},{id:"Local.Whiskey",name:"Local Whiskey",lat:"40.793683",lon:"-77.860092"},{id:"Mad.Mex",name:"Mad Mex",lat:"40.793872",lon:"-77.85852"},{id:"The.Phyrst",name:"The Phyrst",lat:"40.793683",lon:"-77.860092"},{id:"Bill.Pickles.Tap.Room",name:"Bill Pickles Tap Room",lat:"40.794156",lon:"-77.861386"},{id:"The.Rathskeller",name:"The Rathskeller",lat:"40.795151",lon:"-77.860357"},{id:"Rotellis",name:"Rotellis",lat:"40.795699",lon:"-77.858772"},{id:"Rumors.Lounge",name:"Rumors Lounge",lat:"40.791536",lon:"-77.864552"},{id:"The.Saloon",name:"The Saloon",lat:"40.797315",lon:"-77.857395"},{id:"The.Shandygaff",name:"The Shandygaff",lat:"40.795301",lon:"-77.859534"},{id:"The.Tavern.Restaurant",name:"The Tavern Restaurant",lat:"40.795677",lon:"-77.859783"},{id:"Z.Bar...The.Deli",name:"Z Bar @ The Deli",lat:"40.797133",lon:"-77.857179"},{id:"Zenos",name:"Zenos",lat:"40.79432",lon:"-77.861621"}],a.preferences={cost:"50",alcohol:"50",distance:"50",length:"10"},a.queryRunning=!1,a.map={center:{latitude:40.7948,longitude:-77.859},zoom:13,markers:[],polyline:{visible:!0,fill:{color:"#FF0000",opacity:1},stroke:{color:"#FF0000",weight:10,opacity:1},path:[{latitude:0,longitude:0},{latitude:0,longitude:.001}]},icon:"//maps.gstatic.com/mapfiles/markers2/marker.png"},a.displayMarkers=function(a){console.log(a)},n(),d.getGenericRouteRequestId(f.barId).then(function(a){l("Creating a Generic Bar Crawl"),g(a);var b=a;setTimeout(function(){d.getResult(b).then(function(a){h(a),m("We found you a tour! You can refine it if you'd like.")})},7e3)}),a.refineTour=function(){d.getPreferenceRouteRequestId(a.preferences.cost,a.preferences.alcohol,a.preferences.distance,f.barId).then(function(a){l("Creating a Custom Bar Crawl based on your preferences."),g(a);var b=a;setTimeout(function(){d.getResult(b).then(function(a){h(a),m("We created a custom tour for you!")})},7e3)})},a.open=function(){var d=b.open({templateUrl:"crawlPreferences.html",controller:"ModalInstanceCtrl",resolve:{preferences:function(){return a.preferences}}});d.result.then(function(b){a.preferences=b,a.refineTour()},function(){c.info("Modal dismissed at: "+new Date)})}}]).controller("ModalInstanceCtrl",["$scope","$modalInstance","preferences",function(a,b,c){a.preferences=c,a.selectedLength=a.preferences.length,a.optionsLength={from:1,to:20,step:1,dimension:""},a.selectedCost=a.preferences.cost,a.optionsCost={from:1,to:100,step:1,dimension:"  $$"},a.selectedAlcohol=a.preferences.alcohol,a.optionsAlc={from:1,to:100,step:1,dimension:""},a.selectedDistance=a.preferences.distance,a.optionsDist={from:1,to:100,step:1,dimension:""},a.ok=function(){b.close({cost:a.selectedCost,alcohol:a.selectedAlcohol,distance:a.selectedDistance,length:a.selectedLength}),console.log(a.selectedLength)},a.cancel=function(){b.dismiss("cancel")}}]);var serviceModule=angular.module("module.service",[]);serviceModule.service("crawlrService",["$http","$q",function(a,b){return{getGenericRouteRequestId:function(c){var d=b.defer();return a({method:"GET",url:"http://crawlrapi.herokuapp.com/route/"+c}).success(function(a){d.resolve(a)}).error(function(){d.reject("Error getting crawlr front page.")}),d.promise},getResult:function(c){var d=b.defer();return a({method:"GET",url:"http://crawlrapi.herokuapp.com/result/"+c+"/.json"}).success(function(a){d.resolve(angular.fromJson(a).tours)}).error(function(){d.reject("Error getting crawlr front page.")}),d.promise},getPreferenceRouteRequestId:function(c,d,e,f){var g=b.defer();return a({method:"POST",url:"http://crawlrapi.herokuapp.com/route/"+f,data:"cost="+c+"&alcohol="+d+"&distance="+e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a){g.resolve(a)}).error(function(){g.reject("Error getting crawlr front page.")}),g.promise}}}]),angular.module("module.filter",[]).filter("ReplaceDots",function(){return function(a,b){return a.replace(/\./g,b)}});